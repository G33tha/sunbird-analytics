package org.ekstep.analytics.updater

/**
  * Ref:Design wiki link: https://project-sunbird.atlassian.net/wiki/spaces/SBDES/pages/794198025/Design+Brainstorm+Data+structure+for+capturing+dashboard+portal+metrics
  * Ref:Implementation wiki link: https://project-sunbird.atlassian.net/wiki/spaces/SBDES/pages/794099772/Data+Product+Dashboard+summariser+-+Cumulative
  *
  * @author Manjunath Davanam <manjunathd@ilimi.in>
  */

import com.datastax.spark.connector._
import org.apache.spark.SparkContext
import org.apache.spark.rdd.RDD
import org.ekstep.analytics.adapter.ContentAdapter
import org.ekstep.analytics.framework._
import org.ekstep.analytics.framework.dispatcher.AzureDispatcher
import org.ekstep.analytics.framework.util.{CommonUtil, JSONUtils, RestUtil}
import org.ekstep.analytics.util.{Constants, WorkFlowUsageSummaryFact}

import scala.util.Try


case class WorkflowSummaryEvents(deviceId: String, mode: String, dType: String, totalSession: Long, totalTs: Double) extends AlgoInput with Input


case class Publisher_agg(buckets: List[Buckets])

case class Buckets(key: String, doc_count: Double, publisher_agg: Language_agg)

case class Language_agg(buckets: List[Buckets])

case class Aggregations(language_agg: Language_agg)

case class ESResponse(aggregations: Aggregations)

case class Publisher(id: String, count: Double)

case class languagePublisher(language: String, publishers: List[Publisher])

case class contentPublished(count: Int, languages: List[languagePublisher])

case class Metrics(noOfUniqueDevices: Long, totalContentPlaySessions: Long, totalTimeSpent: Double, totalContentPublished: contentPublished) extends AlgoOutput with Output

case class PortalMetrics(eid: String, ets: Long, syncts: Long, metrics_summary: Option[Metrics]) extends AlgoOutput with Output

object UpdatePortalMetrics extends IBatchModelTemplate[DerivedEvent, WorkflowSummaryEvents, Metrics, PortalMetrics] with Serializable {

  val className = "org.ekstep.analytics.updater.UpdatePortalMetrics"

  private val EVENT_ID: String = "ME_PORTAL_CUMULATIVE_METRICS"

  override def name: String = "UpdatePortalMetrics"

  /**
    * preProcess which will fetch the `WorkFlowUsageSummaryFact` Event data from the Cassandra Database.
    *
    * @param data   - RDD Event Data(Empty RDD event)
    * @param config - Configurations to run preProcess
    * @param sc     - SparkContext
    * @return - workflowSummaryEvents
    */
  override def preProcess(data: RDD[DerivedEvent], config: Map[String, AnyRef])(implicit sc: SparkContext): RDD[WorkflowSummaryEvents] = {
    sc.cassandraTable[WorkFlowUsageSummaryFact](Constants.PLATFORM_KEY_SPACE_NAME, Constants.WORKFLOW_USAGE_SUMMARY_FACT).filter { x => x.d_period == 0 && x.d_tag.equals("all") && x.d_content_id.equals("all") && x.d_user_id.equals("all") }.map(event => {
      WorkflowSummaryEvents(event.d_device_id, event.d_mode, event.d_type, event.m_total_sessions, event.m_total_ts)
    })
  }

  /**
    *
    * @param data   - RDD Workflow summary event data
    * @param config - Configurations to algorithm
    * @param sc     - Spark context
    * @return - DashBoardSummary ->(uniqueDevices, totalContentPlayTime, totalTimeSpent,)
    */
  override def algorithm(data: RDD[WorkflowSummaryEvents], config: Map[String, AnyRef])(implicit sc: SparkContext): RDD[Metrics] = {
    object _constant extends Enumeration {
      val APP = "app"
      val PLAY = "play"
      val CONTENT = "content"
      val SESSION = "session"
      val ALL = "all"
    }

    val uniqueDevicesCount = data.filter(x => x.deviceId != _constant.ALL).map(_.deviceId).distinct().count()
    val totalContentPlaySessions = data.filter(x => x.mode.equalsIgnoreCase(_constant.PLAY) && x.dType.equalsIgnoreCase(_constant.CONTENT) && x.deviceId.equals("all")).map(_.totalSession).sum().toLong
    val totalTimeSpent = data.filter(x => (x.dType.equalsIgnoreCase(_constant.APP) || x.dType.equalsIgnoreCase(_constant.SESSION)) && x.deviceId.equals("all")).map(_.totalTs).sum()
    val publishedContentCount: Int = Try(ContentAdapter.getPublishedContentList().count).getOrElse(0)
    sc.parallelize(Array(Metrics(uniqueDevicesCount, totalContentPlaySessions, CommonUtil.roundDouble(totalTimeSpent / 3600, 2), contentPublished(publishedContentCount, getLanguageAndPublisherList()))))
  }

  /**
    *
    * @param data   - RDD DashboardSummary Event
    * @param config - Configurations to run postprocess method
    * @param sc     - Spark context
    * @return - ME_PORTAL_CUMULATIVE_METRICS MeasuredEvents
    */
  override def postProcess(data: RDD[Metrics], config: Map[String, AnyRef])(implicit sc: SparkContext): RDD[PortalMetrics] = {
    val record = data.first()
    val measures = Metrics(record.noOfUniqueDevices, record.totalContentPlaySessions, record.totalTimeSpent, record.totalContentPublished)
    val metrics = PortalMetrics(EVENT_ID, System.currentTimeMillis(), System.currentTimeMillis(), Some(measures))
    if (config.getOrElse("dispatch", false).asInstanceOf[Boolean]) {
      AzureDispatcher.dispatch(Array(JSONUtils.serialize(metrics)), config)
    }
    sc.parallelize(Array(metrics))
  }

  /**
    * This method is used to get the list of list and count of publisher by language
    *
    * @return List of languagePublisher
    */
  private def getLanguageAndPublisherList(): List[languagePublisher] = {
    val endPoint = Constants.ELASTIC_SEARCH_SERVICE_ENDPOINT
    val index = Constants.ELASTIC_SEARCH_INDEX_COMPOSITESEARCH_NAME
    val apiURL = s"$endPoint/$index/_search"
    val request =
      s"""
         |{"_source":false,"query":{"bool":{"must":[{"match":{"status":{"query":"Live","operator":"AND","lenient":false,"zero_terms_query":"NONE"}}}],"should":[{"match":{"objectType":{"query":"Content","operator":"OR","lenient":false,"zero_terms_query":"NONE"}}},{"match":{"objectType":{"query":"ContentImage","operator":"OR","lenient":false,"zero_terms_query":"NONE"}}},{"match":{"contentType":{"query":"Resource","operator":"OR","lenient":false,"zero_terms_query":"NONE"}}},{"match":{"contentType":{"query":"Collection","operator":"OR","lenient":false,"zero_terms_query":"NONE"}}}]}},"aggs":{"language_agg":{"terms":{"field":"language.raw","size":300},"aggs":{"publisher_agg":{"terms":{"field":"lastPublishedBy.raw","size":1000}}}}}}
                    """.stripMargin
    val response = RestUtil.post[ESResponse](apiURL, request)
    println("ES_RESPONSE", response);
    //
    //            val res =
    //            s"""
    //               |{"took":152,"timed_out":false,"_shards":{"total":5,"successful":5,"skipped":0,"failed":0},"hits":{"total":238454,"max_score":16.775232,"hits":[{"_index":"compositesearch_v2","_type":"cs","_id":"do_2122952875771248641386.img","_score":16.775232},{"_index":"compositesearch_v2","_type":"cs","_id":"do_212349670217015296188.img","_score":16.775232},{"_index":"compositesearch_v2","_type":"cs","_id":"do_212344942347632640143.img","_score":16.775232},{"_index":"compositesearch_v2","_type":"cs","_id":"do_2123567715297853441253.img","_score":16.702158},{"_index":"compositesearch_v2","_type":"cs","_id":"do_20046526.img","_score":12.998116},{"_index":"compositesearch_v2","_type":"cs","_id":"do_2123229899264573441612.img","_score":12.998116},{"_index":"compositesearch_v2","_type":"cs","_id":"do_21232577134199603214.img","_score":12.998116},{"_index":"compositesearch_v2","_type":"cs","_id":"do_212295921898455040193.img","_score":12.998116},{"_index":"compositesearch_v2","_type":"cs","_id":"do_212295922493259776195.img","_score":12.998116},{"_index":"compositesearch_v2","_type":"cs","_id":"do_212295922818097152196.img","_score":12.998116}]},"aggregations":{"language_agg":{"doc_count_error_upper_bound":0,"sum_other_doc_count":0,"buckets":[{"key":"english","doc_count":61483,"publisher_agg":{"doc_count_error_upper_bound":0,"sum_other_doc_count":0,"buckets":[{"key":"68777b59-b28b-4aee-88d6-50d46e4c3509","doc_count":1070},{"key":"64866862-5bc4-4ad3-afb4-6f243d56f89c","doc_count":536},{"key":"ekstep","doc_count":534},{"key":"d64765d3-c0c2-4142-adb0-01d1a15d9c3d","doc_count":312},{"key":"84c69651-37b9-4c6f-8fe5-c1ec90653556","doc_count":232},{"key":"86dd77ad-18d7-4d27-b72c-ba732b4009d3","doc_count":232},{"key":"74400baf-7f32-407a-9d79-265ecd3f6952","doc_count":190},{"key":"18150cf9-b839-4ccd-956a-66e359f22278","doc_count":188},{"key":"9d92839b-6f7e-447e-a1a2-505af40ea40f","doc_count":172},{"key":"c97a1728-acdd-4ebd-9683-017559f211d8","doc_count":171},{"key":"test","doc_count":165},{"key":"583","doc_count":142},{"key":"9ac4ea92-fea7-45e6-93f3-02aa3172ea58","doc_count":127},{"key":"a24a21ce-b3ca-4ddb-a5b7-ee8f68f09159","doc_count":107},{"key":"73f3d379-9bcf-4363-a38d-33d69b26586f","doc_count":100},{"key":"ae9c0a2f-50bb-40be-b676-e1d360bfb587","doc_count":92},{"key":"98e09d6e-b95b-4832-bfab-421e63d36aa7","doc_count":90},{"key":"ea8d4e3d-7cfa-4ddc-88ac-e69bcc30a992","doc_count":83},{"key":"68e043de-1e16-4b6d-b85f-736010a395fa","doc_count":82},{"key":"f24442ca-8d5e-4672-8885-493fe0b39067","doc_count":77},{"key":"821","doc_count":67},{"key":"7947d109-2822-4dd2-b1f7-3cd3b897b7e6","doc_count":62},{"key":"794d30dc-ba4f-4f69-a65c-7f970b9b2e52","doc_count":60},{"key":"8feb8c9d-0628-436b-b12d-8fc775dcf3c9","doc_count":54},{"key":"be9e7184-dffd-45af-9e3c-147fdf2c771d","doc_count":51},{"key":"b32fb1b6-e579-4406-881b-79b09609a1e5","doc_count":50},{"key":"57874f98-647c-42ca-bcae-2e572361437f","doc_count":41},{"key":"b57f7db5-aac0-4ed0-8817-9d294655f241","doc_count":41},{"key":"230cb747-6ce9-4e1c-91a8-1067ae291cb9","doc_count":39},{"key":"07ebd230-bfed-4d29-a849-f5033d087d66","doc_count":38},{"key":"79a644c1-3f42-473e-8ffc-4f81fa9aa2ab","doc_count":36},{"key":"799","doc_count":32},{"key":"9fb220fa-d6d0-4b91-94b0-5790eac1b7e9","doc_count":30},{"key":"e6f0ee9e-6ca2-4fc1-9843-432f4dc03668","doc_count":30},{"key":"2ef63b1d-f2ea-4d2c-be83-5de344061782","doc_count":29},{"key":"a7369940-0530-4d52-bc09-8f916227c0a9","doc_count":29},{"key":"22ea82d9-c728-4b75-b7b4-9a20c5f100fb","doc_count":28},{"key":"930e3c2b-f7d3-4429-8284-dccc663dcb6b","doc_count":28},{"key":"a0ccd498-750e-479e-8556-903b3b9c32bf","doc_count":28},{"key":"53ccd154-2625-4041-ac5f-26c8296e23cd","doc_count":26},{"key":"7bd5aef5-d825-47fa-96b5-3a3ce3b4020b","doc_count":26},{"key":"77cb999a-0fef-4850-b527-4f0f6f3899f4","doc_count":25},{"key":"2fc9cb44-efd4-4438-9bbc-2f2fb09ce4ad","doc_count":24},{"key":"bd053def-582e-4141-8091-7fda8353a508","doc_count":23},{"key":"805","doc_count":19},{"key":"55970ded-3beb-4fda-9665-706ee1d4b618","doc_count":18},{"key":"832022b0-07e6-42e7-9034-e8a812d2c0ed","doc_count":18},{"key":"bbeb50b2-44bb-4fd3-9767-59fbb3ef1ad6","doc_count":18},{"key":"d32e170d-010b-4bc5-ae55-3ac5e547e35b","doc_count":18},{"key":"fd62893b-a246-4fa7-b49d-9aeafaf145b3","doc_count":18},{"key":"53b70a4f-3f0d-4e9f-a61d-5b5ff22894a2","doc_count":17},{"key":"22164d9e-a164-41ae-92a9-b1e4ff25272b","doc_count":16},{"key":"104","doc_count":15},{"key":"3c9e5de8-e2fa-4cbc-af97-4b1c2c8624e4","doc_count":15},{"key":"42f3526e-850b-443d-a560-8d7ff8a48642","doc_count":15},{"key":"454","doc_count":15},{"key":"d5efd1ab-3cad-4034-8143-32c480f5cc9e","doc_count":15},{"key":"306","doc_count":14},{"key":"5bc8ce26-eff4-4f2d-a130-ebcc78ba77fa","doc_count":14},{"key":"804","doc_count":14},{"key":"afed4a57-707b-488f-9e59-e0961679ce7d","doc_count":14},{"key":"d880e3dc-7486-4e00-b947-f2e9709c1e70","doc_count":14},{"key":"sunbird","doc_count":14},{"key":"2f996f21-ff4d-489c-94ec-72f30ef10b4c","doc_count":13},{"key":"659b011a-06ec-4107-84ad-955e16b0a48a","doc_count":13},{"key":"923","doc_count":13},{"key":"70f34f3b-6a6f-4e48-8c43-23d5e10c01f4","doc_count":12},{"key":"7b065111-c64b-49fe-a274-c557831a902b","doc_count":12},{"key":"974","doc_count":12},{"key":"ece9cca2-75db-4e62-babb-88d4a6ce5380","doc_count":12},{"key":"349","doc_count":11},{"key":"4b44e900-4f06-4933-a51f-949a07d5a368","doc_count":11},{"key":"923775aa-b4d7-4ecd-a4c0-c70fbf2e0d6a","doc_count":11},{"key":"948","doc_count":11},{"key":"b61d3df4-34f4-48dd-b28d-42ae19fa7f26","doc_count":11},{"key":"bb335f84-f624-4bdd-9e5e-95c62dc690ff","doc_count":11},{"key":"f2535a14-b404-4a52-a408-bbe9aa0b2ea5","doc_count":11},{"key":"5e18141a-cfcb-4751-a6ea-e61147efdccf","doc_count":10},{"key":"6d113327-45ba-4d6d-9802-515ea05e3af6","doc_count":10},{"key":"6ef994ce-2e00-47dd-b27f-e062a9071076","doc_count":10},{"key":"93ef4d2c-c8ad-487e-833c-1f7ffb4ac346","doc_count":10},{"key":"a56e278c-8e21-43b1-b511-b2cf612b9772","doc_count":10},{"key":"d9d1a128-405d-4121-8609-805c25ed1c70","doc_count":9},{"key":"0b174e4f-eff1-44e9-b15e-415787470456","doc_count":8},{"key":"4c4530df-0d4f-42a5-bd91-0366716c8c24","doc_count":8},{"key":"678161ac-7736-43e8-8bd1-29c9d444769d","doc_count":8},{"key":"b7c83aaf-b8c2-4117-be9f-778f3086ae00","doc_count":8},{"key":"d23de812-4e93-4ba6-8bd2-caae8240fbf0","doc_count":8},{"key":"d882967f-b3e1-456b-b984-d800470837ab","doc_count":8},{"key":"e886f4a8-890e-4e73-adc2-5afebad93c08","doc_count":8},{"key":"ee1bfce6-9c61-4d46-a21e-72bd69f016f1","doc_count":8},{"key":"0db290dc-d1f6-4e33-99c3-8860b1313a63","doc_count":7},{"key":"436","doc_count":7},{"key":"569","doc_count":7},{"key":"769","doc_count":7},{"key":"81773821-2dc1-4aaa-ae18-584717e46e08","doc_count":7},{"key":"abc14976-937c-4b29-88e6-d137cace0913","doc_count":7},{"key":"044fbc96-b0a9-4cb7-9cea-e5832d66f7f9","doc_count":6},{"key":"21ed0378-ff0d-4491-9369-f2da92b33f09","doc_count":6},{"key":"225","doc_count":6},{"key":"239","doc_count":6},{"key":"24e8d34f-a62a-4ee7-9dbc-6e39a07b01f2","doc_count":6},{"key":"329","doc_count":6},{"key":"386","doc_count":6},{"key":"4222e9f1-629a-4a1f-b74d-78fdc0b2768b","doc_count":6},{"key":"434","doc_count":6},{"key":"44917d6c-629f-4911-b4c5-1ff0e910bc0e","doc_count":6},{"key":"637d39ce-739b-46df-a59f-289a083afc57","doc_count":6},{"key":"786","doc_count":6},{"key":"89d84469-5ca4-4203-b55c-1e93fcbe72a7","doc_count":6},{"key":"98aa6154-7eef-444f-b9ac-7265e1e8b8bf","doc_count":6},{"key":"999c5e0d-16f2-47f4-bdf9-c964c4161ad4","doc_count":6},{"key":"b73e7352-04e3-4c93-a326-19cd4e8a6d74","doc_count":6},{"key":"042fcd21-e152-4dc1-b4f1-d66ceb7bc044","doc_count":5},{"key":"0e71a26b-8b9b-4443-ae65-a332fb9ee237","doc_count":5},{"key":"29245c81-8c55-4187-9e4d-9875aba3444f","doc_count":5},{"key":"3111d6f1-3d12-49f6-83d1-0f2c9946bb49","doc_count":5},{"key":"4b940d6f-58b0-41e1-b799-755214a013d0","doc_count":5},{"key":"51ca1bc8-26f0-49bb-b1ff-53c991a59ba0","doc_count":5},{"key":"725","doc_count":5},{"key":"72d4e213-6167-413d-8cb4-252e90508e38","doc_count":5},{"key":"75d8ba4f-3013-4723-b70d-e80d9843b89c","doc_count":5},{"key":"763d629d-85a0-48b8-bd90-1edbdb493f01","doc_count":5},{"key":"77199d17-9358-4a70-b8d2-27a9f810e166","doc_count":5},{"key":"785","doc_count":5},{"key":"7d3dd6ec-e9bb-4298-b260-12b95200984e","doc_count":5},{"key":"8623d657-d2fe-4984-90ca-a9d44e0b52e8","doc_count":5},{"key":"869d1d0c-fc04-47e8-abe7-5b63cb139704","doc_count":5},{"key":"9faaf968-92aa-457e-87cb-1630dbc59ab9","doc_count":5},{"key":"a8c39839-36e0-4cee-9f22-a8dacea2897e","doc_count":5},{"key":"b1208ad8-631f-4d1a-916b-05ddfe305032","doc_count":5},{"key":"b3a2b08e-a708-40d1-a51a-baa8dca18587","doc_count":5},{"key":"be7efb23-6af9-4d92-82b3-a4d78fcfa2f6","doc_count":5},{"key":"fc1b3523-7ed3-4030-8cf5-6f0315e1ff58","doc_count":5},{"key":"fc58cb3f-f4e8-4c6e-a0fa-c879925f9319","doc_count":5},{"key":"2504faf6-a031-4f62-9fa8-543b9fdffa70","doc_count":4},{"key":"2aade7d9-6abf-433b-9a05-3b02cd2eb664","doc_count":4},{"key":"325","doc_count":4},{"key":"3b34c469-460b-4c20-8756-c5fce2de9e69","doc_count":4},{"key":"3ff4ad3a-a912-4d4a-97fe-37d3e83f9822","doc_count":4},{"key":"784c732a-e03f-4b85-bc04-8a58ee1be6aa","doc_count":4},{"key":"7dd6030e-2ae2-4629-8133-491abacd91f1","doc_count":4},{"key":"8453a8a3-fd4d-4b4a-94a7-99132ceab0ec","doc_count":4},{"key":"8c44ad33-34dd-4291-a1b2-1061cc4d75c4","doc_count":4},{"key":"9df02c55-7f60-4fac-99c6-f859826c6e25","doc_count":4},{"key":"afedf3f5-68dd-4357-a0e3-bfdafc660d0b","doc_count":4},{"key":"b76a3020-68e0-4227-bbba-63949fa55922","doc_count":4},{"key":"c0a9ae10-b050-4853-85ac-16d7a2144c8a","doc_count":4},{"key":"c54d5d0c-3c85-4eda-b17b-720c87018b61","doc_count":4},{"key":"ccc02d07-8276-4e56-a867-e8bdea073a14","doc_count":4},{"key":"cfa5f786-2c5a-4428-8640-e95d4b0dccee","doc_count":4},{"key":"06920708-5c45-46e7-bda2-e8bcb3431564","doc_count":3},{"key":"177","doc_count":3},{"key":"226f7fce-1269-4c69-bdb8-e2bda2dd7b96","doc_count":3},{"key":"234","doc_count":3},{"key":"273","doc_count":3},{"key":"419713a9-ad00-41ad-a4cc-5f0019841590","doc_count":3},{"key":"420f472f-1866-4f71-b130-e0fdaab491db","doc_count":3},{"key":"488","doc_count":3},{"key":"4b8bdf0e-f203-4a04-80ca-8dcc612dd7c5","doc_count":3},{"key":"519","doc_count":3},{"key":"564","doc_count":3},{"key":"577e8482-e417-465a-96f3-6ac5072b1167","doc_count":3},{"key":"582","doc_count":3},{"key":"58951b55-e6cd-4afa-a01f-ce0d877d99c6","doc_count":3},{"key":"5d4f35f5-c72b-47c8-9d1a-18098e74fb91","doc_count":3},{"key":"5f4dd524-a7e2-4f89-97b4-fcaaf7f6814d","doc_count":3},{"key":"701a816a-beb9-4713-9c64-32de09d84711","doc_count":3},{"key":"77b6033e-e921-4f1c-a48f-8790f02b86ab","doc_count":3},{"key":"880e3a6e-a23e-4144-bd26-14b5bcce47e7","doc_count":3},{"key":"8ca8da2f-4a2e-4046-a872-07650a255480","doc_count":3},{"key":"9beaf6e5-56fc-4da1-993b-2ee161c5e8f7","doc_count":3},{"key":"b2758176-9108-41b2-b388-2966c47fcc8d","doc_count":3},{"key":"c8f3234e-ca70-4b52-8edf-7077d7eeb53d","doc_count":3},{"key":"e887d01d-b6e4-41eb-9208-b6795a617b6a","doc_count":3},{"key":"ef644daf-69e6-4ed4-ae40-916c21496708","doc_count":3},{"key":"f0ff8962-7a8e-4342-ae2c-35ad46e69dae","doc_count":3},{"key":"f1e04608-1630-48bc-9868-2a8d40acda06","doc_count":3},{"key":"f5317605-2cd2-4d4b-8029-af8445842ddc","doc_count":3},{"key":"fbb16dbb-469f-4a1c-a64f-11f25f0a5e08","doc_count":3},{"key":"09c71afc-c445-4e44-a3fa-095058ebfd4f","doc_count":2},{"key":"0fc67bc4-354d-427c-b29d-5f65fd95d704","doc_count":2},{"key":"14928bd8-4565-466c-9e21-42f86c09a3a4","doc_count":2},{"key":"191e6b5a-8581-46bd-b779-b3b534984649","doc_count":2},{"key":"193e9630-27a4-4499-83e7-b5b0d72908e4","doc_count":2},{"key":"200","doc_count":2},{"key":"244","doc_count":2},{"key":"2b6eed3c-cfe5-410c-8ebf-284e03e59378","doc_count":2},{"key":"2c0e1909-822c-4ae9-925d-dfab7d59807c","doc_count":2},{"key":"316","doc_count":2},{"key":"39ec0df4-7c5a-4c21-9d9b-426f93652af5","doc_count":2},{"key":"3e8de9d0-35cf-4c7e-9eb9-c737a2b6286c","doc_count":2},{"key":"409","doc_count":2},{"key":"412f0550-c946-425b-822f-08e4f14df80e","doc_count":2},{"key":"4275fcbd-ba1e-4388-aa92-510a1635ad44","doc_count":2},{"key":"460","doc_count":2},{"key":"481","doc_count":2},{"key":"52d699a6-3883-4381-a391-d2632cdd9ee5","doc_count":2},{"key":"551","doc_count":2},{"key":"5808cd80-4856-4381-a257-2b4f9c1a4e1c","doc_count":2},{"key":"5dec469b-50be-4654-b822-60d6c44fd278","doc_count":2},{"key":"5fcf1cb6-7ce9-42ea-85fa-891b1db4dae0","doc_count":2},{"key":"63fbcae6-81aa-4702-b487-aa2b3772b0eb","doc_count":2},{"key":"650","doc_count":2},{"key":"66746d16-7ab8-4b65-8604-eea7e76b46a5","doc_count":2},{"key":"6a0b542b-89d0-470c-b512-1d2ee5f15196","doc_count":2},{"key":"7627d5d8-7214-4f22-8fe9-9c4226d9f170","doc_count":2},{"key":"78d6441a-0aff-4e05-889c-4fd01d1a61c3","doc_count":2},{"key":"80","doc_count":2},{"key":"833","doc_count":2},{"key":"871e9976-4f96-43bd-986b-91b92c57dbfc","doc_count":2},{"key":"882299de-6d38-4874-adc7-6686e17d68c6","doc_count":2},{"key":"8855bfb3-e79e-4c7c-b0dd-18ca95f64e4f","doc_count":2},{"key":"88c042d8-0fa9-4a01-82ac-bafdd34ed047","doc_count":2},{"key":"8aa7a56e-25ef-480e-bf82-1fc8eb1a8666","doc_count":2},{"key":"8c93527f-c041-4b76-ad7a-3aef13237182","doc_count":2},{"key":"95e4942d-cbe8-477d-aebd-ad8e6de4bfc8","doc_count":2},{"key":"ac6fd279-ff03-4323-93a2-19a3cd2c7d47","doc_count":2},{"key":"anirban.choubey@tarento.com","doc_count":2},{"key":"b43efb69-b882-4b16-82ef-38f449c9a925","doc_count":2},{"key":"b5db8560-d039-49b3-9e5f-ebe82925fdbe","doc_count":2},{"key":"bbf0aab3-e100-4398-bd73-302760793800","doc_count":2},{"key":"be325d93-600d-4cb2-b2c9-728717c31765","doc_count":2},{"key":"cf471e1b-cf76-41b7-b87e-6f6da05bb32a","doc_count":2},{"key":"d5d3e8af-abb5-4644-a2e9-ebe5f82eac47","doc_count":2},{"key":"db4204f0-1b4a-4729-9b22-07de0754b744","doc_count":2},{"key":"dc1ff5d5-464d-4ece-b200-d2a7144e6b3a","doc_count":2},{"key":"eff43df1-4685-4511-b0f5-056d2187f955","doc_count":2},{"key":"f6602b21-b40a-4842-adcb-966563247b5a","doc_count":2},{"key":"f67585d4-4c39-487f-b623-def80db0fe05","doc_count":2},{"key":"faac1b45-393f-4dcb-a6af-9171e6ded3ed","doc_count":2},{"key":"009f6523-9d90-4b2f-8bd6-5fb39ca5b7dc","doc_count":1},{"key":"00ab93f2-ac97-4203-825c-b2d1c77620e7","doc_count":1},{"key":"00b11deb-65d5-45a8-939e-77b96b3bab72","doc_count":1},{"key":"0306e9e4-401e-409d-84ca-e8a0fbecece6","doc_count":1},{"key":"064c0b3d-eb1c-4a12-aeeb-3f65bbb2a8d3","doc_count":1},{"key":"06b71706-a6b1-42d2-921b-bcc6b0b25fe4","doc_count":1},{"key":"0736a2d5-36ee-43b3-82e7-38288465903d","doc_count":1},{"key":"0f13f8ec-7c34-499f-b318-7470097aa46c","doc_count":1},{"key":"117aeb79-8990-4928-9832-81b05506ec02","doc_count":1},{"key":"1be09099-f6d3-41ca-ad7d-17dca94a698b","doc_count":1},{"key":"1fb8c8fa-ba04-4d09-b05a-4536341b81ee","doc_count":1},{"key":"224","doc_count":1},{"key":"28e2d344-5fb0-46bb-a168-c76940ebb897","doc_count":1},{"key":"28f7bf03-68be-4d62-b794-23040eada4e1","doc_count":1},{"key":"2b1f8731-e04e-4f10-9fc5-eab38b8b4342","doc_count":1},{"key":"2bc137f4-22b1-433c-83ea-03257ab888f8","doc_count":1},{"key":"2f6c2c91-0803-4b70-99bf-d71ae0be531d","doc_count":1},{"key":"341824e6-92a6-4588-bb30-0938edcf5e68","doc_count":1},{"key":"344","doc_count":1},{"key":"361","doc_count":1},{"key":"363","doc_count":1},{"key":"363040ad-6dcc-4673-90a5-14dca5f74c80","doc_count":1},{"key":"3662ee4e-0c8d-4fed-a5d9-867a76672f96","doc_count":1},{"key":"399","doc_count":1},{"key":"40bf3968-68fa-403c-85ae-b47ba48744a9","doc_count":1},{"key":"42175db5-e25c-4fe4-96fe-aa6d26bb8162","doc_count":1},{"key":"438","doc_count":1},{"key":"4738e842-9110-45fe-92a4-5ba9ba5985e3","doc_count":1},{"key":"482","doc_count":1},{"key":"4a1a4fbb-08a3-4e7c-9669-6c48f73dc99e","doc_count":1},{"key":"52b746a9-e50b-4604-9a64-f5423f4f3ff0","doc_count":1},{"key":"52e77bba-f84e-4758-bfbb-1d001d588cf5","doc_count":1},{"key":"53eba86c-6395-4198-8221-657692d427c1","doc_count":1},{"key":"558dc5d8-4597-4d35-b132-ee012d60fafc","doc_count":1},{"key":"561","doc_count":1},{"key":"562","doc_count":1},{"key":"563","doc_count":1},{"key":"563fc2cc-0bfb-4e8b-b1cb-700917d3cf61","doc_count":1},{"key":"672","doc_count":1},{"key":"6b2f6c32-18e7-4d8e-8934-98714d953443","doc_count":1},{"key":"6ccb2976-53c8-4217-8596-d829713e61a4","doc_count":1},{"key":"76917c54-938f-438a-adcf-cba438b13d51","doc_count":1},{"key":"773","doc_count":1},{"key":"788bf5c2-8354-4408-bc61-36fa0f556d97","doc_count":1},{"key":"7940c3b1-a37b-4012-b133-8ce7b98873da","doc_count":1},{"key":"7d1fc9e1-6fd0-4ad5-893c-3cdee46e0202","doc_count":1},{"key":"7f52e152-5699-42fe-b058-bc5377021009","doc_count":1},{"key":"86","doc_count":1},{"key":"898067b2-c988-4bc5-b935-959217a77301","doc_count":1},{"key":"93bbd34a-1004-4e48-be01-8768846c7ba9","doc_count":1},{"key":"93c3c07f-c6be-47fd-bcc2-04c43b4f6017","doc_count":1},{"key":"96624e90-6d74-43f3-b7f6-dbbc5e903788","doc_count":1},{"key":"96ee8497-95e9-40a2-9358-e052ba42a1c2","doc_count":1},{"key":"9aa13bcc-7a6b-41f5-8895-2a67bdb13cf3","doc_count":1},{"key":"a0e11928-d2c2-429f-9f08-068fc08764a3","doc_count":1},{"key":"a7f30548-2254-4220-a737-483876a2e563","doc_count":1},{"key":"aba4528e-1319-4c1d-a8e1-03f535b70eeb","doc_count":1},{"key":"abha singh (via jenkins)","doc_count":1},{"key":"anirbanchoubey@ntp","doc_count":1},{"key":"c2a10ac5-dccb-46ae-8db0-6741ec97c024","doc_count":1},{"key":"c910ab82-43ed-4290-96ca-e87e89c69ca2","doc_count":1},{"key":"caef9af1-008d-4c9a-b3ad-6154b4f45495","doc_count":1},{"key":"cbb50dd5-0057-4e63-91e1-4b9b7561793c","doc_count":1},{"key":"cd7d905c-8ad2-455b-bd3c-fcc30775c94d","doc_count":1},{"key":"d3f7b546-154c-4eda-a1ec-2f70d265dac0","doc_count":1},{"key":"d731b624-24e5-4f36-9ce4-225007438972","doc_count":1},{"key":"d8370576-36a1-4a7b-8705-1486f05f5d62","doc_count":1},{"key":"d8fd9fea-38ad-4f3a-bb45-b95d8d96cd81","doc_count":1},{"key":"da88ec30-acdf-4e99-97b7-1366b7dcc240","doc_count":1},{"key":"db77413c-5599-404f-b0ba-eced899ad1f5","doc_count":1},{"key":"ddf4caa9-6d8e-4366-8fdc-a270711210d4","doc_count":1},{"key":"deepak naryana rao (via jenkins)","doc_count":1},{"key":"e3eb0511-992f-4d43-a9a4-8415ab0206b0","doc_count":1},{"key":"e466e7b1-6c5b-4627-8608-c12601674324","doc_count":1},{"key":"e7aba516-f075-4bbf-b37f-2042b6ce24ed","doc_count":1},{"key":"e7bbff12-8c2a-4d0a-aa29-0f89edfcb9c5","doc_count":1},{"key":"e9dc7366-5056-4c62-99f1-a32081648732","doc_count":1},{"key":"eaa5a6a0-86e2-42ad-a1d5-dcf88bbb4312","doc_count":1},{"key":"f01a8c07-c7e9-4e5d-814c-8f1025731cfa","doc_count":1},{"key":"f0484f55-a83d-48cb-ae31-79ddfab7de85","doc_count":1},{"key":"f18f6b76-a56f-4e5b-83e6-15878ddfc5d3","doc_count":1},{"key":"f19a7b03-16af-438b-87c2-01b972915cec","doc_count":1},{"key":"f34cc426-05f8-4323-9209-d1a79b35a3c8","doc_count":1},{"key":"f52d0552-6a81-41a7-8bcb-20d3bc59049b","doc_count":1},{"key":"fa7d90c1-93a2-4c00-9f59-a25cd0febfb7","doc_count":1},{"key":"fb5a1be2-02ff-4485-9182-7fbd26f8a7bb","doc_count":1},{"key":"fd7ef85c-df8f-4504-b502-47d001085e91","doc_count":1},{"key":"feaace75-ffec-4304-8e2d-214cf38373ad","doc_count":1},{"key":"pradyumna","doc_count":1},{"key":"user name","doc_count":1}]}},{"key":"hindi","doc_count":296,"publisher_agg":{"doc_count_error_upper_bound":0,"sum_other_doc_count":0,"buckets":[{"key":"d64765d3-c0c2-4142-adb0-01d1a15d9c3d","doc_count":34},{"key":"18150cf9-b839-4ccd-956a-66e359f22278","doc_count":21},{"key":"68777b59-b28b-4aee-88d6-50d46e4c3509","doc_count":15},{"key":"be9e7184-dffd-45af-9e3c-147fdf2c771d","doc_count":9},{"key":"ekstep","doc_count":7},{"key":"b32fb1b6-e579-4406-881b-79b09609a1e5","doc_count":6},{"key":"821","doc_count":4},{"key":"129","doc_count":3},{"key":"24e8d34f-a62a-4ee7-9dbc-6e39a07b01f2","doc_count":3},{"key":"7bd5aef5-d825-47fa-96b5-3a3ce3b4020b","doc_count":3},{"key":"312","doc_count":2},{"key":"436","doc_count":2},{"key":"4c4530df-0d4f-42a5-bd91-0366716c8c24","doc_count":2},{"key":"974","doc_count":2},{"key":"b1208ad8-631f-4d1a-916b-05ddfe305032","doc_count":2},{"key":"d5efd1ab-3cad-4034-8143-32c480f5cc9e","doc_count":2},{"key":"f24442ca-8d5e-4672-8885-493fe0b39067","doc_count":2},{"key":"f2535a14-b404-4a52-a408-bbe9aa0b2ea5","doc_count":2},{"key":"0db290dc-d1f6-4e33-99c3-8860b1313a63","doc_count":1},{"key":"18101ca8-4b86-4be5-889d-c426616d5d19","doc_count":1},{"key":"204","doc_count":1},{"key":"230cb747-6ce9-4e1c-91a8-1067ae291cb9","doc_count":1},{"key":"239","doc_count":1},{"key":"28b6995d-c9cb-4894-a7b9-aafff044702d","doc_count":1},{"key":"330","doc_count":1},{"key":"349","doc_count":1},{"key":"3c9e5de8-e2fa-4cbc-af97-4b1c2c8624e4","doc_count":1},{"key":"409","doc_count":1},{"key":"434","doc_count":1},{"key":"482","doc_count":1},{"key":"52d699a6-3883-4381-a391-d2632cdd9ee5","doc_count":1},{"key":"55970ded-3beb-4fda-9665-706ee1d4b618","doc_count":1},{"key":"79a644c1-3f42-473e-8ffc-4f81fa9aa2ab","doc_count":1},{"key":"8623d657-d2fe-4984-90ca-a9d44e0b52e8","doc_count":1},{"key":"86dd77ad-18d7-4d27-b72c-ba732b4009d3","doc_count":1},{"key":"8c93527f-c041-4b76-ad7a-3aef13237182","doc_count":1},{"key":"97ad9968-fd89-4bcc-a07e-568f4cd025a5","doc_count":1},{"key":"9df02c55-7f60-4fac-99c6-f859826c6e25","doc_count":1},{"key":"ac6fd279-ff03-4323-93a2-19a3cd2c7d47","doc_count":1},{"key":"b3a2b08e-a708-40d1-a51a-baa8dca18587","doc_count":1},{"key":"b73e7352-04e3-4c93-a326-19cd4e8a6d74","doc_count":1},{"key":"b76a3020-68e0-4227-bbba-63949fa55922","doc_count":1},{"key":"d882967f-b3e1-456b-b984-d800470837ab","doc_count":1},{"key":"dc1ff5d5-464d-4ece-b200-d2a7144e6b3a","doc_count":1},{"key":"e3eb0511-992f-4d43-a9a4-8415ab0206b0","doc_count":1},{"key":"e431304a-e4bd-4670-8702-59fe18fb6da2","doc_count":1},{"key":"e6f0ee9e-6ca2-4fc1-9843-432f4dc03668","doc_count":1},{"key":"sunbird","doc_count":1}]}},{"key":"bengali","doc_count":106,"publisher_agg":{"doc_count_error_upper_bound":0,"sum_other_doc_count":0,"buckets":[{"key":"804","doc_count":10},{"key":"be9e7184-dffd-45af-9e3c-147fdf2c771d","doc_count":10},{"key":"821","doc_count":8},{"key":"18150cf9-b839-4ccd-956a-66e359f22278","doc_count":6},{"key":"799","doc_count":5},{"key":"68777b59-b28b-4aee-88d6-50d46e4c3509","doc_count":3},{"key":"ekstep","doc_count":3},{"key":"239","doc_count":2},{"key":"79a644c1-3f42-473e-8ffc-4f81fa9aa2ab","doc_count":2},{"key":"7bd5aef5-d825-47fa-96b5-3a3ce3b4020b","doc_count":2},{"key":"0db290dc-d1f6-4e33-99c3-8860b1313a63","doc_count":1},{"key":"177","doc_count":1},{"key":"325","doc_count":1},{"key":"386","doc_count":1},{"key":"581","doc_count":1},{"key":"582","doc_count":1},{"key":"647","doc_count":1},{"key":"b32fb1b6-e579-4406-881b-79b09609a1e5","doc_count":1},{"key":"e3eb0511-992f-4d43-a9a4-8415ab0206b0","doc_count":1}]}},{"key":"gujarati","doc_count":97,"publisher_agg":{"doc_count_error_upper_bound":0,"sum_other_doc_count":0,"buckets":[{"key":"18150cf9-b839-4ccd-956a-66e359f22278","doc_count":7},{"key":"be9e7184-dffd-45af-9e3c-147fdf2c771d","doc_count":7},{"key":"821","doc_count":4},{"key":"68777b59-b28b-4aee-88d6-50d46e4c3509","doc_count":3},{"key":"239","doc_count":2},{"key":"306","doc_count":2},{"key":"sunbird","doc_count":2},{"key":"0db290dc-d1f6-4e33-99c3-8860b1313a63","doc_count":1},{"key":"3c9e5de8-e2fa-4cbc-af97-4b1c2c8624e4","doc_count":1},{"key":"436","doc_count":1},{"key":"482","doc_count":1},{"key":"799","doc_count":1},{"key":"79a644c1-3f42-473e-8ffc-4f81fa9aa2ab","doc_count":1},{"key":"7bd5aef5-d825-47fa-96b5-3a3ce3b4020b","doc_count":1},{"key":"b73e7352-04e3-4c93-a326-19cd4e8a6d74","doc_count":1},{"key":"e3eb0511-992f-4d43-a9a4-8415ab0206b0","doc_count":1},{"key":"e886f4a8-890e-4e73-adc2-5afebad93c08","doc_count":1},{"key":"f24442ca-8d5e-4672-8885-493fe0b39067","doc_count":1}]}},{"key":"marathi","doc_count":95,"publisher_agg":{"doc_count_error_upper_bound":0,"sum_other_doc_count":0,"buckets":[{"key":"f24442ca-8d5e-4672-8885-493fe0b39067","doc_count":17},{"key":"68777b59-b28b-4aee-88d6-50d46e4c3509","doc_count":9},{"key":"18150cf9-b839-4ccd-956a-66e359f22278","doc_count":8},{"key":"cfa5f786-2c5a-4428-8640-e95d4b0dccee","doc_count":3},{"key":"551","doc_count":2},{"key":"79a644c1-3f42-473e-8ffc-4f81fa9aa2ab","doc_count":2},{"key":"81773821-2dc1-4aaa-ae18-584717e46e08","doc_count":2},{"key":"ekstep","doc_count":2},{"key":"0db290dc-d1f6-4e33-99c3-8860b1313a63","doc_count":1},{"key":"129","doc_count":1},{"key":"14df02ff-7e68-4c52-a600-1b1f30c62ffe","doc_count":1},{"key":"273","doc_count":1},{"key":"306b9b31-3c14-487d-83a3-33d7203bd5f0","doc_count":1},{"key":"325","doc_count":1},{"key":"330","doc_count":1},{"key":"349","doc_count":1},{"key":"4275fcbd-ba1e-4388-aa92-510a1635ad44","doc_count":1},{"key":"434","doc_count":1},{"key":"4c4530df-0d4f-42a5-bd91-0366716c8c24","doc_count":1},{"key":"804","doc_count":1},{"key":"821","doc_count":1},{"key":"84c69651-37b9-4c6f-8fe5-c1ec90653556","doc_count":1},{"key":"b1208ad8-631f-4d1a-916b-05ddfe305032","doc_count":1},{"key":"c910ab82-43ed-4290-96ca-e87e89c69ca2","doc_count":1},{"key":"d5efd1ab-3cad-4034-8143-32c480f5cc9e","doc_count":1},{"key":"e3eb0511-992f-4d43-a9a4-8415ab0206b0","doc_count":1},{"key":"e6f0ee9e-6ca2-4fc1-9843-432f4dc03668","doc_count":1},{"key":"faac1b45-393f-4dcb-a6af-9171e6ded3ed","doc_count":1}]}},{"key":"tamil","doc_count":88,"publisher_agg":{"doc_count_error_upper_bound":0,"sum_other_doc_count":0,"buckets":[{"key":"68777b59-b28b-4aee-88d6-50d46e4c3509","doc_count":13},{"key":"be9e7184-dffd-45af-9e3c-147fdf2c771d","doc_count":13},{"key":"ekstep","doc_count":6},{"key":"0db290dc-d1f6-4e33-99c3-8860b1313a63","doc_count":4},{"key":"3c9e5de8-e2fa-4cbc-af97-4b1c2c8624e4","doc_count":4},{"key":"24e8d34f-a62a-4ee7-9dbc-6e39a07b01f2","doc_count":3},{"key":"18150cf9-b839-4ccd-956a-66e359f22278","doc_count":2},{"key":"349","doc_count":2},{"key":"79a644c1-3f42-473e-8ffc-4f81fa9aa2ab","doc_count":2},{"key":"f2535a14-b404-4a52-a408-bbe9aa0b2ea5","doc_count":2},{"key":"230cb747-6ce9-4e1c-91a8-1067ae291cb9","doc_count":1},{"key":"312","doc_count":1},{"key":"4c4530df-0d4f-42a5-bd91-0366716c8c24","doc_count":1},{"key":"581","doc_count":1},{"key":"582","doc_count":1},{"key":"72d4e213-6167-413d-8cb4-252e90508e38","doc_count":1},{"key":"7bd5aef5-d825-47fa-96b5-3a3ce3b4020b","doc_count":1},{"key":"8c93527f-c041-4b76-ad7a-3aef13237182","doc_count":1},{"key":"97ad9968-fd89-4bcc-a07e-568f4cd025a5","doc_count":1},{"key":"b1208ad8-631f-4d1a-916b-05ddfe305032","doc_count":1},{"key":"b73e7352-04e3-4c93-a326-19cd4e8a6d74","doc_count":1},{"key":"d5efd1ab-3cad-4034-8143-32c480f5cc9e","doc_count":1},{"key":"fbb16dbb-469f-4a1c-a64f-11f25f0a5e08","doc_count":1},{"key":"sunbird","doc_count":1},{"key":"test","doc_count":1}]}},{"key":"assamese","doc_count":72,"publisher_agg":{"doc_count_error_upper_bound":0,"sum_other_doc_count":0,"buckets":[{"key":"239","doc_count":9},{"key":"18150cf9-b839-4ccd-956a-66e359f22278","doc_count":6},{"key":"68777b59-b28b-4aee-88d6-50d46e4c3509","doc_count":5},{"key":"804","doc_count":3},{"key":"821","doc_count":3},{"key":"129","doc_count":2},{"key":"306","doc_count":2},{"key":"be9e7184-dffd-45af-9e3c-147fdf2c771d","doc_count":2},{"key":"0db290dc-d1f6-4e33-99c3-8860b1313a63","doc_count":1},{"key":"230cb747-6ce9-4e1c-91a8-1067ae291cb9","doc_count":1},{"key":"28b6995d-c9cb-4894-a7b9-aafff044702d","doc_count":1},{"key":"454","doc_count":1},{"key":"551","doc_count":1},{"key":"799","doc_count":1},{"key":"8623d657-d2fe-4984-90ca-a9d44e0b52e8","doc_count":1},{"key":"98e09d6e-b95b-4832-bfab-421e63d36aa7","doc_count":1},{"key":"e6f0ee9e-6ca2-4fc1-9843-432f4dc03668","doc_count":1},{"key":"ekstep","doc_count":1}]}},{"key":"kannada","doc_count":60,"publisher_agg":{"doc_count_error_upper_bound":0,"sum_other_doc_count":0,"buckets":[{"key":"98e09d6e-b95b-4832-bfab-421e63d36aa7","doc_count":16},{"key":"18150cf9-b839-4ccd-956a-66e359f22278","doc_count":6},{"key":"974","doc_count":4},{"key":"68777b59-b28b-4aee-88d6-50d46e4c3509","doc_count":2},{"key":"79a644c1-3f42-473e-8ffc-4f81fa9aa2ab","doc_count":2},{"key":"230cb747-6ce9-4e1c-91a8-1067ae291cb9","doc_count":1},{"key":"306","doc_count":1},{"key":"799","doc_count":1},{"key":"821","doc_count":1},{"key":"8623d657-d2fe-4984-90ca-a9d44e0b52e8","doc_count":1},{"key":"be9e7184-dffd-45af-9e3c-147fdf2c771d","doc_count":1},{"key":"d5efd1ab-3cad-4034-8143-32c480f5cc9e","doc_count":1},{"key":"d882967f-b3e1-456b-b984-d800470837ab","doc_count":1},{"key":"dc1ff5d5-464d-4ece-b200-d2a7144e6b3a","doc_count":1},{"key":"ekstep","doc_count":1},{"key":"f24442ca-8d5e-4672-8885-493fe0b39067","doc_count":1},{"key":"f2535a14-b404-4a52-a408-bbe9aa0b2ea5","doc_count":1},{"key":"fbb16dbb-469f-4a1c-a64f-11f25f0a5e08","doc_count":1}]}},{"key":"telugu","doc_count":27,"publisher_agg":{"doc_count_error_upper_bound":0,"sum_other_doc_count":0,"buckets":[{"key":"f24442ca-8d5e-4672-8885-493fe0b39067","doc_count":8},{"key":"68777b59-b28b-4aee-88d6-50d46e4c3509","doc_count":3},{"key":"7bd5aef5-d825-47fa-96b5-3a3ce3b4020b","doc_count":1},{"key":"be9e7184-dffd-45af-9e3c-147fdf2c771d","doc_count":1},{"key":"ekstep","doc_count":1},{"key":"test","doc_count":1}]}},{"key":"odia","doc_count":23,"publisher_agg":{"doc_count_error_upper_bound":0,"sum_other_doc_count":0,"buckets":[{"key":"18150cf9-b839-4ccd-956a-66e359f22278","doc_count":6},{"key":"0db290dc-d1f6-4e33-99c3-8860b1313a63","doc_count":1},{"key":"582","doc_count":1},{"key":"be9e7184-dffd-45af-9e3c-147fdf2c771d","doc_count":1},{"key":"f2535a14-b404-4a52-a408-bbe9aa0b2ea5","doc_count":1}]}},{"key":"other","doc_count":5,"publisher_agg":{"doc_count_error_upper_bound":0,"sum_other_doc_count":0,"buckets":[{"key":"18150cf9-b839-4ccd-956a-66e359f22278","doc_count":2},{"key":"4c4530df-0d4f-42a5-bd91-0366716c8c24","doc_count":1},{"key":"68777b59-b28b-4aee-88d6-50d46e4c3509","doc_count":1},{"key":"b73e7352-04e3-4c93-a326-19cd4e8a6d74","doc_count":1}]}},{"key":"urdu","doc_count":3,"publisher_agg":{"doc_count_error_upper_bound":0,"sum_other_doc_count":0,"buckets":[{"key":"821","doc_count":1},{"key":"ekstep","doc_count":1}]}},{"key":"maithili","doc_count":2,"publisher_agg":{"doc_count_error_upper_bound":0,"sum_other_doc_count":0,"buckets":[{"key":"821","doc_count":1}]}},{"key":"sanskrit","doc_count":2,"publisher_agg":{"doc_count_error_upper_bound":0,"sum_other_doc_count":0,"buckets":[{"key":"821","doc_count":1}]}},{"key":"in any language","doc_count":1,"publisher_agg":{"doc_count_error_upper_bound":0,"sum_other_doc_count":0,"buckets":[]}},{"key":"nepali","doc_count":1,"publisher_agg":{"doc_count_error_upper_bound":0,"sum_other_doc_count":0,"buckets":[{"key":"517","doc_count":1}]}}]}}}
    //               """.stripMargin
    //        val response:ESResponse = JSONUtils.deserialize[ESResponse](res)

    response.aggregations.language_agg.buckets.map(languageBucket => {
      val publishers = languageBucket.publisher_agg.buckets.map(publisherBucket => {
        (Publisher(publisherBucket.key, publisherBucket.doc_count))
      })
      languagePublisher(languageBucket.key, publishers)
    })
  }
}